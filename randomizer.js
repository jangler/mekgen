// generated code, DO NOT EDIT

// included from dat/chassis.json
const chassis = [
	{
		"name": "firemoth",
		"mek_name": "FRM",
		"engine_mass": [null, 0.5, 1, 1.5, 2.5, 3, 4, 5, 6, 7, 8.5, 10, 11.5, 13.5, 16, 19, 22.5],
		"gyro_mass": [null, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 4],
		"jet_mass": 0.5,
		"max_armor": [9, 10, 12, 10, 6, 6, 8, 8],
		"lower_leg_actuator": true,
		"torso_twist": true,
		"max_mass": 20
	},
	{
		"name": "kit fox",
		"mek_name": "KTF",
		"engine_mass": [null, 1, 1.5, 3, 4, 5.5, 7, 9, 11.5, 14.5, 19, 24, 33],
		"gyro_mass": [null, 1, 1, 1, 2, 2, 2, 3, 3, 3, 3, 4, 4],
		"jet_mass": 0.5,
		"max_armor": [9, 14, 20, 14, 10, 10, 14, 14],
		"lower_leg_actuator": true,
		"torso_twist": false,
		"max_mass": 30
	},
	{
		"name": "jenner",
		"mek_name": "JNR",
		"engine_mass": [null, 1, 2, 3.5, 5, 7, 9, 12, 16, 21.5, 29.5, 43.5],
		"gyro_mass": [null, 1, 1, 2, 2, 2, 3, 3, 3, 4, 4, 4],
		"jet_mass": 0.5,
		"max_armor": [9, 16, 22, 16, 12, 12, 16, 16],
		"lower_leg_actuator": false,
		"torso_twist": true,
		"max_mass": 35
	},
	{
		"name": "nova",
		"mek_name": "NVA",
		"engine_mass": [null, 1.5, 3, 5.5, 8.5, 12.5, 19, 29.5, 52.5],
		"gyro_mass": [null, 1, 1, 2, 2, 3, 3, 4, 4],
		"jet_mass": 0.5,
		"max_armor": [9, 24, 32, 24, 16, 16, 24, 24],
		"lower_leg_actuator": true,
		"torso_twist": false,
		"max_mass": 50
	},
	{
		"name": "stormcrow",
		"mek_name": "STM",
		"engine_mass": [null, 1.5, 3.5, 6, 10, 15.5, 24, 43.5],
		"gyro_mass": [null, 1, 2, 2, 3, 3, 4, 4],
		"jet_mass": 0.5,
		"max_armor": [9, 26, 36, 26, 18, 18, 26, 26],
		"lower_leg_actuator": true,
		"torso_twist": true,
		"max_mass": 55
	},
	{
		"name": "mad dog",
		"mek_name": "MDG",
		"engine_mass": [null, 1.5, 4, 7, 11.5, 19, 33],
		"gyro_mass": [null, 1, 2, 2, 3, 3, 4],
		"jet_mass": 1,
		"max_armor": [9, 28, 40, 28, 20, 20, 28, 28],
		"lower_leg_actuator": true,
		"torso_twist": true,
		"max_mass": 60
	},
	{
		"name": "hellbringer",
		"mek_name": "HLB",
		"engine_mass": [null, 2, 4.5, 8, 13.5, 23.5, 46],
		"gyro_mass": [null, 1, 2, 2, 3, 4, 4],
		"jet_mass": 1,
		"max_armor": [9, 30, 42, 30, 20, 20, 30, 30],
		"lower_leg_actuator": true,
		"torso_twist": true,
		"max_mass": 65
	},
	{
		"name": "rifleman",
		"mek_name": "RFL",
		"engine_mass": [null, 2, 4.5, 8, 13.5, 23.5, 46],
		"gyro_mass": [null, 1, 2, 2, 3, 4, 4],
		"jet_mass": 1,
		"max_armor": [9, 30, 42, 30, 20, 20, 30, 30],
		"lower_leg_actuator": true,
		"torso_twist": false,
		"max_mass": 65
	},
	{
		"name": "summoner",
		"mek_name": "SMN",
		"engine_mass": [null, 2, 5, 9, 16, 29.5],
		"gyro_mass": [null, 1, 2, 3, 3, 4],
		"jet_mass": 1,
		"max_armor": [9, 30, 44, 30, 22, 22, 30, 30],
		"lower_leg_actuator": true,
		"torso_twist": true,
		"max_mass": 70
	},
	{
		"name": "timber wolf",
		"mek_name": "TBR",
		"engine_mass": [null, 2, 5.5, 10, 19, 38.5],
		"gyro_mass": [null, 1, 2, 3, 3, 4],
		"jet_mass": 1,
		"max_armor": [9, 32, 46, 32, 24, 24, 32, 32],
		"lower_leg_actuator": true,
		"torso_twist": true,
		"max_mass": 75
	},
	{
		"name": "gargoyle",
		"mek_name": "GRG",
		"engine_mass": [null, 2.5, 6, 11.5, 22.5, 52.5],
		"gyro_mass": [null, 1, 2, 3, 4, 4],
		"jet_mass": 1,
		"max_armor": [9, 34, 50, 34, 26, 26, 34, 34],
		"lower_leg_actuator": true,
		"torso_twist": true,
		"max_mass": 80
	},
	{
		"name": "warhammer",
		"mek_name": "WHM",
		"engine_mass": [null, 2.5, 6, 11.5, 22.5, 52.5],
		"gyro_mass": [null, 1, 2, 3, 4, 4],
		"jet_mass": 1,
		"max_armor": [9, 34, 50, 34, 26, 26, 34, 34],
		"lower_leg_actuator": true,
		"torso_twist": true,
		"max_mass": 80
	},
	{
		"name": "marauder",
		"mek_name": "MRD",
		"engine_mass": [null, 2.5, 6, 13, 27],
		"gyro_mass": [null, 1, 2, 3, 4],
		"jet_mass": 1,
		"max_armor": [9, 36, 54, 36, 28, 28, 36, 36],
		"lower_leg_actuator": true,
		"torso_twist": true,
		"max_mass": 85
	},
	{
		"name": "warhawk",
		"mek_name": "WHK",
		"engine_mass": [null, 2.5, 6, 13, 27],
		"gyro_mass": [null, 1, 2, 3, 4],
		"jet_mass": 1,
		"max_armor": [9, 36, 54, 36, 28, 28, 36, 36],
		"lower_leg_actuator": true,
		"torso_twist": true,
		"max_mass": 85
	},
	{
		"name": "dire wolf",
		"mek_name": "DRW",
		"engine_mass": [null, 3, 8.5, 19, 52.5],
		"gyro_mass": [null, 1, 2, 3, 4],
		"jet_mass": 2,
		"max_armor": [9, 42, 62, 42, 34, 34, 42, 42],
		"lower_leg_actuator": true,
		"torso_twist": true,
		"max_mass": 100
	}
];

// included from dat/criticals.json
const criticals = {
	"LRM20": {
		"id": 1,
		"crit": [1, 1, 1, 1, 1, 1, 1, 1]
	},
	"LRM10": {
		"id": 101,
		"crit": [1, 1, 1, 1, 1, 1, 1, 1]
	},
	"LRM15": {
		"id": 201,
		"crit": [2, 2, 2, 2, 2, 2, 2, 2]
	},
	"LRM5": {
		"id": 301,
		"crit": [2, 2, 2, 2, 2, 2, 2, 2]
	},
	"SRM6": {
		"id": 401,
		"crit": [1, 1, 1, 1, 1, 1, 1, 1]
	},
	"SRM4": {
		"id": 501,
		"crit": [1, 1, 1, 1, 1, 1, 1, 1]
	},
	"SRM2": {
		"id": 601,
		"crit": [1, 1, 1, 1, 1, 1, 1, 1]
	},
	"SSRM6": {
		"id": 701,
		"crit": [2, 2, 2, 2, 2, 2, 2, 2]
	},
	"SSRM4": {
		"id": 801,
		"crit": [1, 1, 1, 1, 1, 1, 1, 1]
	},
	"SSRM2": {
		"id": 901,
		"crit": [1, 1, 1, 1, 1, 1, 1, 1]
	},
	"MGun": {
		"id": 1001,
		"crit": [1, 1, 1, 1, 1, 1, 1, 1]
	},
	"GAUSS": {
		"id": 1101,
		"crit": [6, 6, 6, 6, 6, 6, 6, 6]
	},
	"xAC2": {
		"id": 1201,
		"crit": [3, 3, 3, 3, 3, 3, 3, 3]
	},
	"xAC5": {
		"id": 1301,
		"crit": [4, 4, 4, 4, 4, 4, 4, 4]
	},
	"xAC10": {
		"id": 1401,
		"crit": [5, 5, 5, 5, 5, 5, 5, 5]
	},
	"xAC20": {
		"id": 1501,
		"crit": [9, 9, 9, 9, 9, 9, 9, 9]
	},
	"uAC2": {
		"id": 1601,
		"crit": [2, 2, 2, 2, 2, 2, 2, 2]
	},
	"uAC5": {
		"id": 1701,
		"crit": [3, 3, 3, 3, 3, 3, 3, 3]
	},
	"uAC10": {
		"id": 1801,
		"crit": [4, 4, 4, 4, 4, 4, 4, 4]
	},
	"uAC20": {
		"id": 1901,
		"crit": [8, 8, 8, 8, 8, 8, 8, 8]
	},
	"PPC": {
		"id": 2101,
		"crit": [2, 2, 2, 2, 2, 2, 2, 2]
	},
	"LLASER": {
		"id": 2201,
		"crit": [1, 1, 1, 1, 1, 1, 1, 1]
	},
	"MLASER": {
		"id": 2301,
		"crit": [1, 1, 1, 1, 1, 1, 1, 1]
	},
	"SLASER": {
		"id": 2401,
		"crit": [1, 1, 1, 1, 1, 1, 1, 1]
	},
	"LPLAS": {
		"id": 2501,
		"crit": [2, 2, 2, 2, 2, 2, 2, 2]
	},
	"MPLAS": {
		"id": 2601,
		"crit": [1, 1, 1, 1, 1, 1, 1, 1]
	},
	"SPLAS": {
		"id": 2701,
		"crit": [1, 1, 1, 1, 1, 1, 1, 1]
	},
	"MASC": {
		"id": 5001,
		"crit": [1, 1, 1, 1, 1, 1, 1, 1]
	},
	"right_shoulder": {
		"id": 5301,
		"crit": [0, 0, 0, 0, 1, 0, 0, 0]
	},
	"left_shoulder": {
		"id": 5301,
		"crit": [0, 0, 0, 0, 0, 1, 0, 0]
	},
	"right_upper_arm_actuator": {
		"id": 5351,
		"crit": [0, 0, 0, 0, 1, 0, 0, 0]
	},
	"left_upper_arm_actuator": {
		"id": 5351,
		"crit": [0, 0, 0, 0, 0, 1, 0, 0]
	},
	"right_lower_arm_actuator": {
		"id": 5401,
		"crit": [0, 0, 0, 0, 1, 0, 0, 0]
	},
	"left_lower_arm_actuator": {
		"id": 5401,
		"crit": [0, 0, 0, 0, 0, 1, 0, 0]
	},
	"right_hand_actuator": {
		"id": 5451,
		"crit": [0, 0, 0, 0, 1, 0, 0, 0]
	},
	"left_hand_actuator": {
		"id": 5451,
		"crit": [0, 0, 0, 0, 0, 1, 0, 0]
	},
	"right_hip": {
		"id": 5501,
		"crit": [0, 0, 0, 0, 0, 0, 1, 0]
	},
	"left_hip": {
		"id": 5501,
		"crit": [0, 0, 0, 0, 0, 0, 0, 1]
	},
	"right_upper_leg_actuator": {
		"id": 5551,
		"crit": [0, 0, 0, 0, 0, 0, 1, 0]
	},
	"left_upper_leg_actuator": {
		"id": 5551,
		"crit": [0, 0, 0, 0, 0, 0, 0, 1]
	},
	"right_lower_leg_actuator": {
		"id": 5601,
		"crit": [0, 0, 0, 0, 0, 0, 1, 0]
	},
	"left_lower_leg_actuator": {
		"id": 5601,
		"crit": [0, 0, 0, 0, 0, 0, 0, 1]
	},
	"right_foot_actuator": {
		"id": 5651,
		"crit": [0, 0, 0, 0, 0, 0, 1, 0]
	},
	"left_foot_actuator": {
		"id": 5651,
		"crit": [0, 0, 0, 0, 0, 0, 0, 1]
	},
	"gyro": {
		"id": 5800,
		"crit": [0, 0, 3, 0, 0, 0, 0, 0]
	},
	"sensors": {
		"id": 5700,
		"crit": [2, 0, 0, 0, 0, 0, 0, 0]
	},
	"cockpit": {
		"id": 5750,
		"crit": [1, 0, 0, 0, 0, 0, 0, 0]
	},
	"center_engine": {
		"id": 5850,
		"crit": [0, 0, 6, 0, 0, 0, 0, 0]
	},
	"right_xl_engine": {
		"id": 5850,
		"crit": [0, 2, 0, 0, 0, 0, 0, 0]
	},
	"left_xl_engine": {
		"id": 5850,
		"crit": [0, 0, 0, 2, 0, 0, 0, 0]
	},
	"life_support": {
		"id": 5900,
		"crit": [2, 0, 0, 0, 0, 0, 0, 0]
	},
	"single_heat_sink": {
		"id": 6001,
		"crit": [1, 1, 1, 1, 1, 1, 1, 1]
	},
	"double_heat_sink": {
		"id": 6001,
		"crit": [2, 2, 2, 2, 2, 2, 2, 2]
	},
	"jump_jet": {
		"id": 7001,
		"crit": [0, 1, 1, 1, 0, 0, 1, 1]
	},
	"endo_steel": {
		"id": 8001,
		"crit": [1, 1, 1, 1, 1, 1, 1, 1]
	},
	"ferro_fibrous": {
		"id": 9001,
		"crit": [1, 1, 1, 1, 1, 1, 1, 1]
	},
	"ammo_LRM20": {
		"id": 10001,
		"crit": [1, 1, 1, 1, 1, 1, 1, 1]
	},
	"ammo_LRM10": {
		"id": 10101,
		"crit": [1, 1, 1, 1, 1, 1, 1, 1]
	},
	"ammo_LRM15": {
		"id": 10201,
		"crit": [1, 1, 1, 1, 1, 1, 1, 1]
	},
	"ammo_LRM5": {
		"id": 10301,
		"crit": [1, 1, 1, 1, 1, 1, 1, 1]
	},
	"ammo_SRM6": {
		"id": 10401,
		"crit": [1, 1, 1, 1, 1, 1, 1, 1]
	},
	"ammo_SRM4": {
		"id": 10501,
		"crit": [1, 1, 1, 1, 1, 1, 1, 1]
	},
	"ammo_SRM2": {
		"id": 10601,
		"crit": [1, 1, 1, 1, 1, 1, 1, 1]
	},
	"ammo_SSRM6": {
		"id": 10701,
		"crit": [1, 1, 1, 1, 1, 1, 1, 1]
	},
	"ammo_SSRM4": {
		"id": 10801,
		"crit": [1, 1, 1, 1, 1, 1, 1, 1]
	},
	"ammo_SSRM2": {
		"id": 10901,
		"crit": [1, 1, 1, 1, 1, 1, 1, 1]
	},
	"ammo_MGun": {
		"id": 11001,
		"crit": [1, 1, 1, 1, 1, 1, 1, 1]
	},
	"ammo_GAUSS": {
		"id": 11101,
		"crit": [1, 1, 1, 1, 1, 1, 1, 1]
	},
	"ammo_xAC2": {
		"id": 11201,
		"crit": [1, 1, 1, 1, 1, 1, 1, 1]
	},
	"ammo_xAC5": {
		"id": 11301,
		"crit": [1, 1, 1, 1, 1, 1, 1, 1]
	},
	"ammo_xAC10": {
		"id": 11401,
		"crit": [1, 1, 1, 1, 1, 1, 1, 1]
	},
	"ammo_xAC20": {
		"id": 11501,
		"crit": [1, 1, 1, 1, 1, 1, 1, 1]
	},
	"ammo_uAC2": {
		"id": 11601,
		"crit": [1, 1, 1, 1, 1, 1, 1, 1]
	},
	"ammo_uAC5": {
		"id": 11701,
		"crit": [1, 1, 1, 1, 1, 1, 1, 1]
	},
	"ammo_uAC10": {
		"id": 11801,
		"crit": [1, 1, 1, 1, 1, 1, 1, 1]
	},
	"ammo_uAC20": {
		"id": 11901,
		"crit": [1, 1, 1, 1, 1, 1, 1, 1]
	}
};

// included from dat/mechlab.json
const mechlab = {
	"xl_mult": 0.5,
	"cockpit_mass": 3,
	"internal_mult": 0.1,
	"endo_mult": 0.5,
	"endo_crit": 7,
	"armor_unit_mass": 0.5,
	"std_armor": [0, 8, 16, 24, 32, 40, 48, 56, 64, 72, 80, 88, 96, 104, 112, 120, 128, 136, 144, 152, 160, 168, 176, 184, 192, 200, 208, 216, 224, 232, 240, 248, 256, 264, 272, 280, 288, 296, 304, 312],
	"ferro_armor": [0, 10, 19, 29, 38, 48, 58, 67, 77, 86, 96, 106, 115, 125, 134, 144, 154, 163, 173, 182, 192, 202, 211, 221, 230, 240, 250, 259, 269, 278, 288, 298, 307],
	"ferro_crit": 7,
	"ammo_unit_mass": 1,
	"body_crits": [6, 12, 12, 12, 12, 12, 6, 6]
};

// included from dat/mekfmt.json
const mekfmt = {
	"part_type": [3, 5, 6, 5, 3, 3, 4, 4]
};

// included from dat/weapons.json
const weapons = [
	{
		"name": "LLASER",
		"heat": 12,
		"damage": 10,
		"range": 1019,
		"mass": 4,
		"crit": 1,
		"ammo": 0
	},
	{
		"name": "MLASER",
		"heat": 5,
		"damage": 7,
		"range": 510,
		"mass": 1,
		"crit": 1,
		"ammo": 0
	},
	{
		"name": "SLASER",
		"heat": 2,
		"damage": 5,
		"range": 255,
		"mass": 0.5,
		"crit": 1,
		"ammo": 0
	},
	{
		"name": "PPC",
		"heat": 15,
		"damage": 15,
		"range": 746,
		"mass": 6,
		"crit": 2,
		"ammo": 0
	},
	{
		"name": "LPLAS",
		"heat": 10,
		"damage": 10,
		"range": 815,
		"mass": 6,
		"crit": 2,
		"ammo": 0
	},
	{
		"name": "MPLAS",
		"heat": 4,
		"damage": 7,
		"range": 408,
		"mass": 2,
		"crit": 1,
		"ammo": 0
	},
	{
		"name": "SPLAS",
		"heat": 2,
		"damage": 3,
		"range": 203,
		"mass": 1,
		"crit": 1,
		"ammo": 0
	},
	{
		"name": "GAUSS",
		"heat": 1,
		"damage": 15,
		"range": 1820,
		"mass": 12,
		"crit": 6,
		"ammo": 8
	},
	{
		"name": "xAC2",
		"heat": 1,
		"damage": 2,
		"range": 800,
		"mass": 5,
		"crit": 3,
		"ammo": 45
	},
	{
		"name": "xAC5",
		"heat": 1,
		"damage": 5,
		"range": 700,
		"mass": 7,
		"crit": 4,
		"ammo": 20
	},
	{
		"name": "xAC10",
		"heat": 2,
		"damage": 10,
		"range": 600,
		"mass": 10,
		"crit": 5,
		"ammo": 10
	},
	{
		"name": "xAC20",
		"heat": 6,
		"damage": 20,
		"range": 450,
		"mass": 12,
		"crit": 9,
		"ammo": 5
	},
	{
		"name": "MGun",
		"heat": 0,
		"damage": 2,
		"range": 175,
		"mass": 0.25,
		"crit": 1,
		"ammo": 200
	},
	{
		"name": "uAC2",
		"heat": 1,
		"damage": 2,
		"range": 700,
		"mass": 5,
		"crit": 2,
		"ammo": 45
	},
	{
		"name": "uAC5",
		"heat": 1,
		"damage": 5,
		"range": 600,
		"mass": 7,
		"crit": 3,
		"ammo": 20
	},
	{
		"name": "uAC10",
		"heat": 3,
		"damage": 10,
		"range": 500,
		"mass": 10,
		"crit": 4,
		"ammo": 10
	},
	{
		"name": "uAC20",
		"heat": 7,
		"damage": 20,
		"range": 400,
		"mass": 12,
		"crit": 8,
		"ammo": 5
	},
	{
		"name": "SRM 2",
		"heat": 2,
		"damage": 4,
		"range": 497,
		"mass": 0.5,
		"crit": 1,
		"ammo": 50
	},
	{
		"name": "SRM 4",
		"heat": 3,
		"damage": 8,
		"range": 497,
		"mass": 1,
		"crit": 1,
		"ammo": 25
	},
	{
		"name": "SRM 6",
		"heat": 4,
		"damage": 12,
		"range": 497,
		"mass": 1.5,
		"crit": 1,
		"ammo": 15
	},
	{
		"name": "SSRM2",
		"heat": 2,
		"damage": 4,
		"range": 497,
		"mass": 1,
		"crit": 1,
		"ammo": 50
	},
	{
		"name": "SSRM4",
		"heat": 3,
		"damage": 8,
		"range": 497,
		"mass": 2,
		"crit": 1,
		"ammo": 25
	},
	{
		"name": "SSRM6",
		"heat": 4,
		"damage": 12,
		"range": 497,
		"mass": 3,
		"crit": 2,
		"ammo": 15
	},
	{
		"name": "LRM5",
		"heat": 2,
		"damage": 5,
		"range": 1000,
		"mass": 1,
		"crit": 1,
		"ammo": 24
	},
	{
		"name": "LRM10",
		"heat": 4,
		"damage": 10,
		"range": 1000,
		"mass": 2.5,
		"crit": 1,
		"ammo": 12
	},
	{
		"name": "LRM15",
		"heat": 5,
		"damage": 15,
		"range": 1000,
		"mass": 3.5,
		"crit": 2,
		"ammo": 8
	},
	{
		"name": "LRM20",
		"heat": 6,
		"damage": 20,
		"range": 1000,
		"mass": 5,
		"crit": 4,
		"ammo": 6
	}
];

// included from src/mek.js

const HEAD = 0;
const RIGHT_TORSO = 1, CENTER_TORSO = 2, LEFT_TORSO = 3;
const RIGHT_ARM = 4, LEFT_ARM = 5;
const RIGHT_LEG = 6, LEFT_LEG = 7;

// returns a byte array representing a MEK file for the given mech.
function writeMEK(mech) {
	let num_bytes = 344 + 8 * (mech.weapons.length + mech.ammo.length) + 50;
	let array = new Uint8Array(num_bytes);

	// "header"
	array[0] = mech.chassis.max_mass;
	array[4] = mech.engine;
	array[8] = mech.num_jets;
	array[12] = mech.num_heat_sinks;
	array[16] = mech.weapons.length;
	array[20] = mech.ammo.length;
	let offset = 24;

	// body sections
	for (let i = HEAD; i <= LEFT_LEG; i++) {
		setBodyPart(array.subarray(offset, offset + 40), mech, i);
		offset += 40;
	}

	// weapon/ammo list
	for (let i = 0; i < mech.weapons.length; i++) {
		let weapon = mech.weapons[i];
		setWeaponOrAmmo(array.subarray(offset, offset + 4), weapon, false);
		array[offset + 4] = 0xff;
		array[offset + 5] = 0xff;
		for (let j = 0; j < weapon.ammo; j++) {
			setWeaponOrAmmo(array.subarray(offset, offset + 4), weapon, true);
			setWeaponOrAmmo(array.subarray(offset + 4, offset + 8), weapon, false);
		}
		offset += 8;
	}

	// name/comment
	for (let i = 0; i < mech.variant_name.length; i++) {
		array[offset + i] = mech.variant_name.charCodeAt(i);
	}

	return array;
}

// fills a byte array with a body part data structure.
function setBodyPart(array, mech, part) {
	array[0] = mech.front_armor[part];
	array[4] = mech.rear_armor[part];
	array[8] = mekfmt.part_type[part];
	for (let i = 0; i < mech.criticals[part].length; i++) {
		let thing = mech.criticals[part][i];
		let id = criticals[thing]['id'];
		array[12 + i * 2] = id & 0xff;
		array[13 + i * 2] = id >> 8;
	}
	array[36] = mechlab.body_crits[part];
	array[38] = 1; // unknown
}

// fills a byte array with a weapon data structure.
// TODO handle ammo IDs correctly
function setWeaponOrAmmo(array, item, is_ammo) {
	let id = criticals[item.name]['id'];
	if (is_ammo) {
		id += 10000;
	}
	if (item.number != 0) {
		id += item.number - 1; // e.g. the "#1" in "ER PPC #1"
	}
	array[0] = id & 0xff;
	array[1] = id >> 8;
}

// included from src/roll.js

const JET_CHANCE = 4/15; // 4 out of 15 chassis have jets standard
const MIN_ARMOR_FRACTION = 0.5;
const MIN_ARMOR_FRONT_BACK_RATIO = 1;
const MAX_ARMOR_FRONT_BACK_RATIO = 2.5;

// returns a fully specified random mech within the given limitations.
// TODO don't allow engines + jets to be more than total allowed mass
function rollMech(options) {
	let mech = {xl: true, endo: true, ferro: true, weapons: [], ammo: [],
		num_heat_sinks: 20};
	mech.chassis = rollChassis(options.min_mass, options.max_mass);
	if (mech.chassis === undefined) {
		console.error('invalid mass restrictions');
	}
	mech.engine = rollEngine(mech.chassis);
	if (options.always_max_jets) {
		mech.num_jets = mech.engine;
	} else {
		mech.num_jets = rollJets(mech.engine);
	}
	rollArmor(mech);
	allocateCriticals(mech);
	rollWeapons(mech, options.require_energy_weapon);
	mech.variant_name = 'mekgen test';
	return mech;
}

// linear distribution within tonnage constraint.
function rollChassis(min_mass, max_mass) {
	// lazy code for no infinite loops
	for (let i = 0; i < 100; i++) {
		let index = Math.floor(Math.random() * chassis.length);
		let mass = chassis[index].max_mass;
		if (mass >= min_mass && mass <= max_mass) {
			return chassis[index];
		}
	}
}

// linear distribution among the chassis' n/2 fastest engines.
function rollEngine(chassis) {
	let n = chassis.engine_mass.length;
	return Math.ceil(n/2) + Math.floor(Math.random() * n/2);
}

// rolls the number of jets a mech will have.
function rollJets(engine) {
	if (Math.random() < JET_CHANCE) {
		return 1 + Math.floor(Math.random() * engine);
	}
	return 0;
}

// rolls the amount of armor a mech will have.
// TODO: what happens if free_mass and MIN_ARMOR_FRACTION are unsatisfiable?
function rollArmor(mech) {
	// determine quantity of armor
	let free_mass = mechFreeMass(mech);
	let total_max_armor = sum(mech.chassis.max_armor);
	let fraction = MIN_ARMOR_FRACTION + Math.random() * (1 - MIN_ARMOR_FRACTION);
	if (ferroArmorMass(total_max_armor * fraction) > free_mass) {
		fraction = free_mass / ferroArmorMass(total_max_armor * fraction);
	}

	// determine distribution of armor
	let ratio = MIN_ARMOR_FRONT_BACK_RATIO +
		Math.random() * (MAX_ARMOR_FRONT_BACK_RATIO - MIN_ARMOR_FRONT_BACK_RATIO);
	mech.front_armor = [0, 0, 0, 0, 0, 0, 0, 0];
	mech.rear_armor = [0, 0, 0, 0, 0, 0, 0, 0];
	for (let i = 0; i < mech.front_armor.length; i++) {
		if (i == RIGHT_TORSO || i == CENTER_TORSO || i == LEFT_TORSO) {
			mech.front_armor[i] = Math.floor(mech.chassis.max_armor[i] *
				fraction / (1 + ratio) * ratio);
			mech.rear_armor[i] = Math.floor(mech.chassis.max_armor[i] *
				fraction / (1 + ratio));
		} else {
			mech.front_armor[i] = Math.floor(mech.chassis.max_armor[i] * fraction);
		}
	}
}

// returns the sum of an array of numbers.
function sum(array) {
	let x = 0;
	for (let i = 0; i < array.length; i++) {
		x += array[i];
	}
	return x;
}

// returns the mass required for a number of armor units, using ferro-f armor.
function ferroArmorMass(units) {
	for (let i = 0; i < mechlab.ferro_armor.length; i++) {
		if (mechlab.ferro_armor[i] >= units) {
			return i * mechlab.armor_unit_mass;
		}
	}
	// return undefined for impossible values
}

// returns the amount of unused mass.
function mechFreeMass(mech) {
	return mech.chassis.max_mass - mechUsedMass(mech);
}

// returns the amount of used mass.
function mechUsedMass(mech) {
	let mass = mech.chassis.gyro_mass[mech.engine] + mechlab.cockpit_mass +
		Math.max(criticals.double_heat_sink) + mech.jet_mass * mech.num_jets;

	// engine
	if (mech.xl) {
		mass += mech.chassis.engine_mass[mech.engine] * mechlab.xl_mult;
	} else {
		mass += mech.chassis.engine_mass[mech.engine];
	}

	// internal
	if (mech.endo) {
		mass += mech.chassis.max_mass * mechlab.internal_mult * mechlab.endo_mult;
	} else {
		mass += mech.chassis.max_mass * mechlab.internal_mult;
	}

	// armor
	if (mech.ferro) {
		mass += ferroArmorMass
	} else {
		console.error('std armor mass NYI'); // TODO
	}

	// weapons/ammo
	for (let i = 0; i < mech.weapons.length; i++) {
		mass += weapons[mech.weapons[i]].mass;
		mass += mech.weapons[i].ammo * mechlab.ammo_unit_mass;
	}
}

// (re)allocates all a mech's criticals.
function allocateCriticals(mech) {
	// init crits list if necessary
	mech.criticals = [[], [], [], [], [], [], [], []]

	// accumulate required criticals
	let required_crits = ['life_support', 'sensors', 'cockpit', 'center_engine', 'gyro',
		'right_shoulder', 'left_shoulder', 'right_upper_arm_actuator',
		'left_upper_arm_actuator', 'right_hip', 'left_hip', 'right_upper_leg_actuator',
		'left_upper_leg_actuator', 'right_foot_actuator', 'left_foot_actuator'];
	if (mech.chassis.lower_leg_actuator) {
		required_crits.push('left_lower_leg_actuator', 'right_lower_leg_actuator');
	}
	if (mech.xl) {
		required_crits.push('right_xl_engine', 'left_xl_engine');
	}
	if (mech.endo) {
		for (let i = 0; i < mechlab.endo_crit; i++) {
			required_crits.push('endo_steel');
		}
	}
	if (mech.ferro) {
		for (let i = 0; i < mechlab.ferro_crit; i++) {
			required_crits.push('ferro_fibrous');
		}
	}
	for (let i = 0; i < mech.num_jets; i++) {
		required_crits.push('jump_jet');
	}
	// TODO weapons, ammo

	// allocate criticals
	// TODO: what happens if something doesn't fit?
	for (let i = 0; i < required_crits.length; i++) {
		let name = required_crits[i];
		let crit = criticals[name];
		let start = 0, end = mech.criticals.length, step = 1;
		if (name == 'jump_jet') {
			// prefer leg allocation for jump jets
			start = mech.criticals.length - 1, end = -1, step = -1;
		}
		for (let j = start; j != end; j += step) {
			let part = mech.criticals[j];
			if (crit.crit[j] > 0 &&
				mechlab.body_crits[j] - part.length >= crit.crit[j]) {
				for (let k = 0; k < crit.crit[j]; k++) {
					part.push(name);
				}
				break;
			}
		}
	}
}

// randomly allocates weapons and ammo to the mech, including allocating
// criticals.
function rollWeapons(mech, require_energy_weapon) {
	// TODO
}
